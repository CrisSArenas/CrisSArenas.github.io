<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TERMINAL HEIST</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --terminal-bg: #0a0e1a;
    --terminal-text: #00ff41;
    --terminal-dim: #00aa2a;
    --terminal-bright: #00ffaa;
    --panel-bg: rgba(15, 20, 35, 0.95);
    --border: #00ff4155;
    --error: #ff3366;
    --warning: #ffaa33;
    --success: #00ff41;
    --agent: #00aaff;
}

body {
    font-family: 'Courier New', 'Consolas', monospace;
    background: linear-gradient(135deg, #050810 0%, #0a0e1a 100%);
    color: var(--terminal-text);
    overflow: hidden;
    height: 100vh;
}

.game-container {
    display: grid;
    grid-template-rows: auto 1fr auto;
    height: 100vh;
    max-width: 1600px;
    margin: 0 auto;
}

.top-bar {
    background: var(--panel-bg);
    border-bottom: 1px solid var(--border);
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    backdrop-filter: blur(10px);
}

.top-bar-left {
    display: flex;
    align-items: center;
    gap: 30px;
}

.game-title {
    font-size: 20px;
    font-weight: bold;
    color: var(--terminal-bright);
    text-shadow: 0 0 10px var(--terminal-bright);
}

.top-bar-stats {
    display: flex;
    gap: 20px;
    font-size: 14px;
}

.stat {
    display: flex;
    align-items: center;
    gap: 5px;
}

.stat-label {
    color: var(--terminal-dim);
}

.stat-value {
    color: var(--terminal-bright);
}

.top-bar-right {
    display: flex;
    gap: 10px;
}

.icon-btn {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--terminal-text);
    padding: 8px 15px;
    cursor: pointer;
    font-family: inherit;
    font-size: 14px;
    transition: all 0.2s;
}

.icon-btn:hover {
    background: rgba(0, 255, 65, 0.1);
    border-color: var(--terminal-bright);
    box-shadow: 0 0 10px rgba(0, 255, 65, 0.3);
}

.main-content {
    display: grid;
    grid-template-columns: 1fr 400px;
    gap: 1px;
    background: var(--border);
    overflow: hidden;
}

.terminal-section {
    background: var(--terminal-bg);
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
}

.terminal-output {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    scroll-behavior: smooth;
    font-size: 14px;
    line-height: 1.6;
}

.terminal-output::-webkit-scrollbar {
    width: 8px;
}

.terminal-output::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.3);
}

.terminal-output::-webkit-scrollbar-thumb {
    background: var(--terminal-dim);
    border-radius: 4px;
}

.output-line {
    margin-bottom: 4px;
    animation: fadeIn 0.2s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-2px); }
    to { opacity: 1; transform: translateY(0); }
}

.prompt-line {
    color: var(--terminal-bright);
}

.command-line {
    color: var(--terminal-text);
}

.error-line {
    color: var(--error);
}

.success-line {
    color: var(--success);
}

.warning-line {
    color: var(--warning);
}

.agent-line {
    color: var(--agent);
}

.dim-line {
    color: var(--terminal-dim);
}

.header-line {
    color: var(--terminal-bright);
    font-weight: bold;
    margin-top: 10px;
}

.separator {
    color: var(--terminal-dim);
    margin: 10px 0;
}

.glow {
    text-shadow: 0 0 8px currentColor;
}

.input-section {
    background: rgba(0, 0, 0, 0.5);
    padding: 15px 20px;
    border-top: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 10px;
}

.input-prompt {
    color: var(--terminal-bright);
    font-weight: bold;
}

.input-field {
    flex: 1;
    background: transparent;
    border: none;
    color: var(--terminal-text);
    font-family: inherit;
    font-size: 14px;
    outline: none;
}

.input-caret {
    display: inline-block;
    width: 8px;
    height: 16px;
    background: var(--terminal-bright);
    animation: blink 1s step-end infinite;
}

@keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
}

.side-panel {
    background: var(--panel-bg);
    backdrop-filter: blur(10px);
    overflow-y: auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.panel-section {
    border: 1px solid var(--border);
    padding: 15px;
    background: rgba(0, 0, 0, 0.3);
}

.panel-title {
    color: var(--terminal-bright);
    font-size: 16px;
    font-weight: bold;
    margin-bottom: 10px;
    text-shadow: 0 0 5px var(--terminal-bright);
}

.objective-text {
    color: var(--terminal-text);
    font-size: 13px;
    line-height: 1.5;
    margin-bottom: 15px;
}

.checklist {
    list-style: none;
}

.checklist-item {
    font-size: 13px;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.checklist-item.completed {
    color: var(--terminal-dim);
    text-decoration: line-through;
}

.checklist-item.completed .check {
    color: var(--success);
}

.check {
    color: var(--terminal-dim);
}

.inventory-list {
    list-style: none;
    font-size: 13px;
}

.inventory-item {
    margin-bottom: 5px;
    color: var(--warning);
}

.agent-buttons {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
}

.agent-btn {
    background: rgba(0, 170, 255, 0.1);
    border: 1px solid var(--agent);
    color: var(--agent);
    padding: 10px;
    cursor: pointer;
    font-family: inherit;
    font-size: 12px;
    transition: all 0.2s;
}

.agent-btn:hover {
    background: rgba(0, 170, 255, 0.2);
    box-shadow: 0 0 10px rgba(0, 170, 255, 0.3);
}

.agent-suggestion {
    background: rgba(0, 170, 255, 0.05);
    border: 1px solid var(--agent);
    padding: 10px;
    font-size: 12px;
    color: var(--agent);
    margin-top: 10px;
    display: none;
}

.agent-suggestion.visible {
    display: block;
    animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

.overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    backdrop-filter: blur(5px);
}

.modal {
    background: linear-gradient(135deg, #0f1829 0%, #1a2332 100%);
    border: 2px solid var(--terminal-bright);
    border-radius: 8px;
    padding: 40px;
    max-width: 600px;
    box-shadow: 0 0 60px rgba(0, 255, 65, 0.3);
    position: relative;
}

.modal h1 {
    color: var(--terminal-bright);
    font-size: 32px;
    margin-bottom: 10px;
    text-shadow: 0 0 20px var(--terminal-bright);
}

.modal .tagline {
    color: var(--terminal-dim);
    font-size: 14px;
    margin-bottom: 30px;
}

.modal p {
    color: var(--terminal-text);
    margin-bottom: 20px;
    line-height: 1.6;
    font-size: 14px;
}

.modal .disclaimer {
    background: rgba(255, 51, 102, 0.1);
    border: 1px solid var(--error);
    padding: 10px;
    margin-bottom: 20px;
    font-size: 12px;
    color: var(--error);
}

.modal button {
    background: var(--terminal-text);
    color: #000;
    border: none;
    padding: 12px 30px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    font-family: inherit;
    margin: 5px;
    transition: all 0.2s;
}

.modal button:hover {
    background: var(--terminal-bright);
    box-shadow: 0 0 20px rgba(0, 255, 65, 0.5);
}

.modal button.secondary {
    background: transparent;
    color: var(--terminal-text);
    border: 1px solid var(--terminal-text);
}

.tutorial-step {
    display: none;
    min-height: 100px;
}

.tutorial-step.active {
    display: block;
}

.button-group {
    margin-top: 30px;
    display: flex;
    gap: 10px;
    justify-content: center;
}

.checkbox-container {
    display: flex;
    align-items: center;
    margin-top: 20px;
    color: var(--terminal-dim);
    font-size: 12px;
}

.checkbox-container input {
    margin-right: 10px;
}

.hidden {
    display: none;
}

.scanlines {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    background: linear-gradient(
        transparent 50%,
        rgba(0, 0, 0, 0.05) 50%
    );
    background-size: 100% 4px;
    z-index: 999;
    opacity: 0.3;
}

.vignette {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    box-shadow: inset 0 0 200px rgba(0, 0, 0, 0.8);
    z-index: 998;
}

.title-screen {
    text-align: center;
}

.title-screen h1 {
    font-size: 48px;
    margin-bottom: 20px;
    animation: titleGlow 2s ease-in-out infinite;
}

@keyframes titleGlow {
    0%, 100% { text-shadow: 0 0 20px var(--terminal-bright); }
    50% { text-shadow: 0 0 40px var(--terminal-bright); }
}

.level-complete {
    text-align: center;
    padding: 40px;
}

.rank {
    font-size: 72px;
    color: var(--terminal-bright);
    margin: 20px 0;
    text-shadow: 0 0 30px var(--terminal-bright);
}

.stats-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin: 30px 0;
}

.stat-box {
    border: 1px solid var(--border);
    padding: 15px;
    background: rgba(0, 0, 0, 0.3);
}

@media (max-width: 1024px) {
    .main-content {
        grid-template-columns: 1fr;
    }
    
    .side-panel {
        display: none;
    }
}
</style>
</head>
<body>

<div class="scanlines"></div>
<div class="vignette"></div>

<div class="game-container">
    <div class="top-bar">
        <div class="top-bar-left">
            <div class="game-title">TERMINAL HEIST</div>
            <div class="top-bar-stats">
                <div class="stat">
                    <span class="stat-label">LEVEL:</span>
                    <span class="stat-value" id="levelNum">1</span>
                </div>
                <div class="stat">
                    <span class="stat-label">SCORE:</span>
                    <span class="stat-value" id="scoreNum">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">TIME:</span>
                    <span class="stat-value" id="timeNum">0:00</span>
                </div>
            </div>
        </div>
        <div class="top-bar-right">
            <button class="icon-btn" id="helpBtn">HELP</button>
            <button class="icon-btn" id="soundBtn">SOUND: OFF</button>
        </div>
    </div>

    <div class="main-content">
        <div class="terminal-section">
            <div class="terminal-output" id="terminalOutput"></div>
            <div class="input-section">
                <span class="input-prompt" id="inputPrompt">heist@vault:~$</span>
                <input type="text" class="input-field" id="inputField" autocomplete="off" spellcheck="false">
            </div>
        </div>

        <div class="side-panel">
            <div class="panel-section">
                <div class="panel-title">MISSION</div>
                <div class="objective-text" id="objectiveText"></div>
                <ul class="checklist" id="checklistItems"></ul>
            </div>

            <div class="panel-section">
                <div class="panel-title">INVENTORY</div>
                <ul class="inventory-list" id="inventoryList">
                    <li class="dim-line">No items yet...</li>
                </ul>
            </div>

            <div class="panel-section">
                <div class="panel-title">AGENT</div>
                <div class="agent-buttons">
                    <button class="agent-btn" id="hintBtn">HINT</button>
                    <button class="agent-btn" id="explainBtn">EXPLAIN</button>
                    <button class="agent-btn" id="suggestBtn">SUGGEST</button>
                    <button class="agent-btn" id="whyBtn">WHY?</button>
                </div>
                <div class="agent-suggestion" id="agentSuggestion"></div>
            </div>
        </div>
    </div>
</div>

<div id="titleOverlay" class="overlay">
    <div class="modal title-screen">
        <h1>TERMINAL HEIST</h1>
        <div class="tagline">A retro terminal puzzle thriller.</div>
        <div class="disclaimer">
            This is a fictional puzzle sandbox. No real systems involved.
        </div>
        <div class="button-group">
            <button id="startGameBtn">START HEIST</button>
            <button id="tutorialBtn" class="secondary">TUTORIAL</button>
        </div>
    </div>
</div>

<div id="tutorialOverlay" class="overlay hidden">
    <div class="modal">
        <h1>TUTORIAL</h1>
        <div class="tagline">Learn the basics</div>
        
        <div class="tutorial-step active" id="tutStep1">
            <p>Type commands to investigate. Start with: <strong>help</strong></p>
        </div>
        <div class="tutorial-step" id="tutStep2">
            <p>Your objective is shown on the right. Follow clues in files and logs.</p>
        </div>
        <div class="tutorial-step" id="tutStep3">
            <p>Use search to find keywords. Try: <strong>grep key logs/</strong></p>
        </div>
        <div class="tutorial-step" id="tutStep4">
            <p>Stuck? Use the Agent: Hint or Explain.</p>
        </div>
        <div class="tutorial-step" id="tutStep5">
            <p>Complete the objective to advance. Good luck!</p>
        </div>
        
        <div class="button-group">
            <button id="tutBackBtn" class="secondary">BACK</button>
            <button id="tutNextBtn">NEXT</button>
            <button id="tutStartBtn" class="hidden">START</button>
        </div>
        
        <div class="checkbox-container">
            <input type="checkbox" id="skipTutorial">
            <label for="skipTutorial">Don't show again</label>
        </div>
    </div>
</div>

<div id="levelCompleteOverlay" class="overlay hidden">
    <div class="modal level-complete">
        <h1>LEVEL COMPLETE</h1>
        <div class="rank" id="rankDisplay">A</div>
        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-label">Time</div>
                <div class="stat-value" id="completionTime">0:00</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Commands</div>
                <div class="stat-value" id="commandCount">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Hints Used</div>
                <div class="stat-value" id="hintsUsed">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Score</div>
                <div class="stat-value" id="levelScore">0</div>
            </div>
        </div>
        <div class="button-group">
            <button id="nextLevelBtn">NEXT LEVEL</button>
            <button id="retryLevelBtn" class="secondary">RETRY</button>
        </div>
    </div>
</div>

<div id="gameCompleteOverlay" class="overlay hidden">
    <div class="modal level-complete">
        <h1>HEIST COMPLETE</h1>
        <div class="tagline">You've cracked all vaults!</div>
        <p>Final Score: <span id="finalScore" class="glow">0</span></p>
        <div class="button-group">
            <button id="playAgainBtn">PLAY AGAIN</button>
        </div>
    </div>
</div>

<script>
const CONFIG = {
    soundEnabled: false,
    tutorialSeen: false,
    maxHints: 5
};

const GAME_STATE = {
    currentLevel: 0,
    score: 0,
    commandCount: 0,
    hintsUsed: 0,
    startTime: 0,
    currentTime: 0,
    inventory: [],
    completedSteps: [],
    commandHistory: [],
    historyIndex: -1,
    currentPath: '~',
    levelStartTime: 0,
    hintCount: 0,
    filesFound: []
};

const LEVELS = [
    {
        id: 1,
        name: 'BOOTSTRAP',
        objective: 'Find the access code hidden in internal notes.',
        checklist: [
            'Explore the filesystem',
            'Read available notes',
            'Find the access code',
            'Submit the code'
        ],
        filesystem: {
            '~': {
                'readme.txt': 'Welcome to the terminal. Use "help" to see available commands. Your mission: find the access code.',
                'notes': {
                    'memo1.txt': 'Internal memo: The code is stored in one of the project files. Check the dev folder.',
                    'memo2.txt': 'Remember: all access codes follow the pattern CODE-####.'
                },
                'dev': {
                    'project.txt': 'Project Alpha - Status: Active. Access Code: CODE-7429',
                    'backup.txt': 'Backup of old system. Ignore this file.'
                }
            }
        },
        solution: 'CODE-7429',
        hints: [
            'Try using "ls" to see what files are available.',
            'Use "cat" to read file contents. Try "cat readme.txt"',
            'Look for files in the "notes" and "dev" folders.',
            'The code follows the pattern CODE-####. Use "grep CODE" to search.',
            'Once you find the code, use "submit CODE-7429"'
        ]
    },
    {
        id: 2,
        name: 'LOG DIVE',
        objective: 'Identify which subsystem is failing and retrieve the recovery key.',
        checklist: [
            'Check system logs',
            'Identify failing device',
            'Locate recovery key',
            'Submit device ID and key'
        ],
        filesystem: {
            '~': {
                'mission.txt': 'Multiple devices reporting errors. Check logs to find which device is critical. Then find its recovery key.',
                'logs': {
                    'device_A.log': '[12:00] Device A: Status OK\n[12:15] Device A: All systems nominal',
                    'device_B.log': '[12:00] Device B: CRITICAL ERROR\n[12:15] Device B: System failure detected\n[12:30] Device B: Recovery needed - Key: REC-8844',
                    'device_C.log': '[12:00] Device C: Status OK\n[12:15] Device C: Minor warning cleared'
                },
                'docs': {
                    'protocol.txt': 'Recovery Protocol: When a device shows CRITICAL ERROR, submit its ID and recovery key.'
                }
            }
        },
        solution: 'device_B:REC-8844',
        hints: [
            'Check the logs folder. Use "ls logs" to see all log files.',
            'Use "cat logs/device_B.log" to read individual logs.',
            'Look for "CRITICAL ERROR" in the logs. Try "grep CRITICAL logs/*"',
            'Device B is failing. Now find its recovery key in the same log.',
            'Submit using format: "submit device_B:REC-8844"'
        ]
    },
    {
        id: 3,
        name: 'ENCODED VAULT',
        objective: 'Decode 3 tokens to reconstruct a passphrase.',
        checklist: [
            'Find 3 encoded tokens',
            'Decode each token',
            'Reconstruct passphrase',
            'Submit passphrase'
        ],
        filesystem: {
            '~': {
                'instructions.txt': 'Three tokens are hidden across the system. Each is encoded with a simple shift cipher. Decode them and combine.',
                'vault': {
                    'token1.enc': 'ENCODED: FQRRQPF',
                    'token2.enc': 'ENCODED: RQPVNQN'
                },
                'archives': {
                    'token3.enc': 'ENCODED: CRTTIQ'
                },
                'cipher_key.txt': 'Cipher: Each letter shifted by +2 (A->C, B->D, etc.)'
            }
        },
        solution: 'DOORMAN CONTROL ACCESS',
        decodedTokens: ['DOORMAN', 'CONTROL', 'ACCESS'],
        hints: [
            'Find all .enc files. Use "ls vault" and "ls archives"',
            'Read each token file with "cat vault/token1.enc"',
            'Use "decode FQRRQPF" to decode the first token.',
            'Decode all three tokens and note the words.',
            'Combine the decoded words and submit: "submit DOORMAN CONTROL ACCESS"'
        ]
    },
    {
        id: 4,
        name: 'THE HANDSHAKE',
        objective: 'Perform a fictional handshake sequence with a vault node.',
        checklist: [
            'View network map',
            'Trace vault node',
            'Generate handshake sequence',
            'Unlock vault'
        ],
        filesystem: {
            '~': {
                'network.txt': 'Network topology includes multiple nodes. Find VAULT-NODE-7 and establish connection.',
                'protocols': {
                    'handshake.txt': 'Handshake Protocol: trace <node> to get connection ID, then handshake <connection-id>'
                }
            }
        },
        solution: 'VAULT-OPENED',
        hints: [
            'Use "map" command to see the network topology.',
            'Find VAULT-NODE-7 on the map.',
            'Use "trace VAULT-NODE-7" to get connection details.',
            'Use "handshake" with the connection ID you received.',
            'Final step: "unlock" to open the vault.'
        ]
    }
];

let terminalOutput = document.getElementById('terminalOutput');
let inputField = document.getElementById('inputField');
let currentLevel = null;

function loadProgress() {
    const saved = localStorage.getItem('terminalHeistProgress');
    if (saved) {
        const data = JSON.parse(saved);
        CONFIG.tutorialSeen = data.tutorialSeen || false;
        CONFIG.soundEnabled = data.soundEnabled || false;
    }
}

function saveProgress() {
    localStorage.setItem('terminalHeistProgress', JSON.stringify({
        tutorialSeen: CONFIG.tutorialSeen,
        soundEnabled: CONFIG.soundEnabled
    }));
}

function initGame() {
    loadProgress();
    
    if (CONFIG.tutorialSeen) {
        document.getElementById('titleOverlay').classList.remove('hidden');
    } else {
        document.getElementById('titleOverlay').classList.remove('hidden');
    }
    
    updateSoundButton();
}

function startLevel(levelIndex) {
    GAME_STATE.currentLevel = levelIndex;
    currentLevel = LEVELS[levelIndex];
    GAME_STATE.commandCount = 0;
    GAME_STATE.hintsUsed = 0;
    GAME_STATE.hintCount = 0;
    GAME_STATE.levelStartTime = Date.now();
    GAME_STATE.inventory = [];
    GAME_STATE.completedSteps = [];
    GAME_STATE.currentPath = '~';
    GAME_STATE.filesFound = [];
    GAME_STATE.commandHistory = [];
    GAME_STATE.historyIndex = -1;
    
    document.getElementById('levelNum').textContent = currentLevel.id;
    
    clearTerminal();
    updateMissionPanel();
    
    printLine('='.repeat(60), 'separator');
    printLine(`LEVEL ${currentLevel.id}: ${currentLevel.name}`, 'header-line glow');
    printLine('='.repeat(60), 'separator');
    printLine('');
    printLine(currentLevel.objective, 'success-line');
    printLine('');
    printLine('Type "help" for available commands.', 'dim-line');
    printLine('Type "objective" to review mission.', 'dim-line');
    printLine('');
    
    inputField.focus();
    startTimer();
}

function clearTerminal() {
    terminalOutput.innerHTML = '';
}

function printLine(text, className = 'output-line') {
    const line = document.createElement('div');
    line.className = className;
    line.textContent = text;
    terminalOutput.appendChild(line);
    terminalOutput.scrollTop = terminalOutput.scrollHeight;
}

function printPrompt(command) {
    printLine(`${document.getElementById('inputPrompt').textContent} ${command}`, 'prompt-line');
}

function updateMissionPanel() {
    document.getElementById('objectiveText').textContent = currentLevel.objective;
    
    const checklist = document.getElementById('checklistItems');
    checklist.innerHTML = '';
    
    currentLevel.checklist.forEach((item, index) => {
        const li = document.createElement('li');
        li.className = 'checklist-item';
        if (GAME_STATE.completedSteps.includes(index)) {
            li.classList.add('completed');
        }
        li.innerHTML = `<span class="check">${GAME_STATE.completedSteps.includes(index) ? 'âœ“' : 'â—‹'}</span> ${item}`;
        checklist.appendChild(li);
    });
    
    updateInventory();
}

function updateInventory() {
    const invList = document.getElementById('inventoryList');
    invList.innerHTML = '';
    
    if (GAME_STATE.inventory.length === 0) {
        const li = document.createElement('li');
        li.className = 'dim-line';
        li.textContent = 'No items yet...';
        invList.appendChild(li);
    } else {
        GAME_STATE.inventory.forEach(item => {
            const li = document.createElement('li');
            li.className = 'inventory-item';
            li.textContent = `> ${item}`;
            invList.appendChild(li);
        });
    }
}

function addToInventory(item) {
    if (!GAME_STATE.inventory.includes(item)) {
        GAME_STATE.inventory.push(item);
        updateInventory();
        playSound('success');
    }
}

function completeStep(stepIndex) {
    if (!GAME_STATE.completedSteps.includes(stepIndex)) {
        GAME_STATE.completedSteps.push(stepIndex);
        GAME_STATE.score += 100;
        updateScore();
        updateMissionPanel();
        playSound('success');
    }
}

function updateScore() {
    document.getElementById('scoreNum').textContent = GAME_STATE.score;
}

function startTimer() {
    if (GAME_STATE.timerInterval) clearInterval(GAME_STATE.timerInterval);
    
    GAME_STATE.timerInterval = setInterval(() => {
        const elapsed = Date.now() - GAME_STATE.levelStartTime;
        const mins = Math.floor(elapsed / 60000);
        const secs = Math.floor((elapsed % 60000) / 1000);
        document.getElementById('timeNum').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
    }, 1000);
}

function stopTimer() {
    if (GAME_STATE.timerInterval) {
        clearInterval(GAME_STATE.timerInterval);
    }
}

function processCommand(input) {
    const trimmed = input.trim();
    if (!trimmed) return;
    
    GAME_STATE.commandHistory.push(trimmed);
    GAME_STATE.historyIndex = GAME_STATE.commandHistory.length;
    GAME_STATE.commandCount++;
    
    printPrompt(trimmed);
    
    const parts = trimmed.split(/\s+/);
    const cmd = parts[0].toLowerCase();
    const args = parts.slice(1);
    
    executeCommand(cmd, args);
}

function executeCommand(cmd, args) {
    const commands = {
        'help': cmdHelp,
        'clear': cmdClear,
        'cls': cmdClear,
        'ls': cmdLs,
        'dir': cmdLs,
        'cd': cmdCd,
        'pwd': cmdPwd,
        'cat': cmdCat,
        'open': cmdCat,
        'grep': cmdGrep,
        'search': cmdGrep,
        'decode': cmdDecode,
        'analyze': cmdAnalyze,
        'inventory': cmdInventory,
        'inv': cmdInventory,
        'objective': cmdObjective,
        'mission': cmdObjective,
        'hint': cmdHint,
        'explain': cmdExplain,
        'submit': cmdSubmit,
        'map': cmdMap,
        'trace': cmdTrace,
        'handshake': cmdHandshake,
        'unlock': cmdUnlock
    };
    
    if (commands[cmd]) {
        commands[cmd](args);
    } else {
        printLine(`Command not found: ${cmd}`, 'error-line');
        printLine('Type "help" for available commands.', 'dim-line');
    }
    
    printLine('');
}

function cmdHelp(args) {
    if (args.length > 0) {
        const helpTexts = {
            'ls': 'ls [path] - List files in directory',
            'cd': 'cd <path> - Change directory',
            'cat': 'cat <file> - Display file contents',
            'grep': 'grep <keyword> <path> - Search for text',
            'decode': 'decode <token> - Decode encrypted token',
            'submit': 'submit <answer> - Submit solution',
            'map': 'map - Show network topology',
            'trace': 'trace <node> - Trace network node'
        };
        
        const topic = args[0].toLowerCase();
        if (helpTexts[topic]) {
            printLine(helpTexts[topic], 'success-line');
        } else {
            printLine(`No help available for: ${topic}`, 'error-line');
        }
        return;
    }
    
    printLine('AVAILABLE COMMANDS:', 'header-line');
    printLine('');
    printLine('  help [cmd]     - Show help (optionally for specific command)', 'dim-line');
    printLine('  clear          - Clear terminal', 'dim-line');
    printLine('  ls [path]      - List files', 'dim-line');
    printLine('  cd <path>      - Change directory', 'dim-line');
    printLine('  pwd            - Print working directory', 'dim-line');
    printLine('  cat <file>     - Read file', 'dim-line');
    printLine('  grep <text>    - Search for text', 'dim-line');
    printLine('  decode <token> - Decode encrypted data', 'dim-line');
    printLine('  analyze <file> - Analyze file structure', 'dim-line');
    printLine('  inventory      - Show collected items', 'dim-line');
    printLine('  objective      - Review mission', 'dim-line');
    printLine('  submit <ans>   - Submit answer', 'dim-line');
    
    if (currentLevel && currentLevel.id >= 4) {
        printLine('  map            - Show network map', 'dim-line');
        printLine('  trace <node>   - Trace network node', 'dim-line');
        printLine('  handshake <id> - Initiate handshake', 'dim-line');
        printLine('  unlock         - Unlock vault', 'dim-line');
    }
    
    completeStep(0);
}

function cmdClear() {
    clearTerminal();
}

function cmdLs(args) {
    const path = args.length > 0 ? args[0] : GAME_STATE.currentPath;
    const resolved = resolvePath(path);
    const dir = getDirectory(resolved);
    
    if (!dir) {
        printLine(`Directory not found: ${path}`, 'error-line');
        return;
    }
    
    if (typeof dir === 'string') {
        printLine(`Not a directory: ${path}`, 'error-line');
        return;
    }
    
    printLine(`Contents of ${resolved}:`, 'header-line');
    printLine('');
    
    for (const name in dir) {
        const isDir = typeof dir[name] === 'object' && !name.includes('.');
        printLine(`  ${isDir ? '[DIR]' : '[FILE]'} ${name}`, isDir ? 'warning-line' : 'success-line');
        
        if (!GAME_STATE.filesFound.includes(resolved + '/' + name)) {
            GAME_STATE.filesFound.push(resolved + '/' + name);
        }
    }
    
    if (GAME_STATE.currentLevel === 0 && GAME_STATE.filesFound.length >= 3) {
        completeStep(0);
    }
}

function cmdCd(args) {
    if (args.length === 0) {
        GAME_STATE.currentPath = '~';
        printLine('Changed to home directory', 'success-line');
        return;
    }
    
    const path = args[0];
    const resolved = resolvePath(path);
    const dir = getDirectory(resolved);
    
    if (!dir || typeof dir === 'string') {
        printLine(`Not a directory: ${path}`, 'error-line');
        return;
    }
    
    GAME_STATE.currentPath = resolved;
    printLine(`Changed directory to ${resolved}`, 'success-line');
}

function cmdPwd() {
    printLine(GAME_STATE.currentPath, 'success-line');
}

function cmdCat(args) {
    if (args.length === 0) {
        printLine('Usage: cat <file>', 'error-line');
        return;
    }
    
    const path = args[0];
    const content = getFile(path);
    
    if (content === null) {
        printLine(`File not found: ${path}`, 'error-line');
        return;
    }
    
    printLine(`--- ${path} ---`, 'header-line');
    printLine(content, 'output-line');
    printLine(`--- END ---`, 'dim-line');
    
    if (!GAME_STATE.filesFound.includes(path)) {
        GAME_STATE.filesFound.push(path);
    }
    
    if (GAME_STATE.currentLevel === 0 && content.includes('CODE-')) {
        completeStep(2);
    }
    
    if (GAME_STATE.currentLevel === 1 && path.includes('device_B')) {
        completeStep(1);
    }
}

function cmdGrep(args) {
    if (args.length < 2) {
        printLine('Usage: grep <keyword> <path>', 'error-line');
        return;
    }
    
    const keyword = args[0];
    const path = args[1];
    
    let found = false;
    
    if (path.endsWith('/*') || path.endsWith('/')) {
        const dirPath = path.replace('/*', '').replace('/', '');
        const resolved = resolvePath(dirPath);
        const dir = getDirectory(resolved);
        
        if (!dir || typeof dir === 'string') {
            printLine(`Not a directory: ${dirPath}`, 'error-line');
            return;
        }
        
        printLine(`Searching for "${keyword}" in ${dirPath}:`, 'header-line');
        printLine('');
        
        for (const name in dir) {
            if (typeof dir[name] === 'string' && dir[name].toLowerCase().includes(keyword.toLowerCase())) {
                printLine(`  ${name}: ${dir[name].substring(0, 80)}...`, 'success-line');
                found = true;
            }
        }
    } else {
        const content = getFile(path);
        if (content === null) {
            printLine(`File not found: ${path}`, 'error-line');
            return;
        }
        
        const lines = content.split('\n');
        printLine(`Searching for "${keyword}" in ${path}:`, 'header-line');
        printLine('');
        
        lines.forEach((line, i) => {
            if (line.toLowerCase().includes(keyword.toLowerCase())) {
                printLine(`  Line ${i + 1}: ${line}`, 'success-line');
                found = true;
            }
        });
    }
    
    if (!found) {
        printLine('No matches found.', 'dim-line');
    }
    
    if (GAME_STATE.currentLevel === 0 && keyword.toLowerCase().includes('code')) {
        completeStep(1);
    }
    
    if (GAME_STATE.currentLevel === 1 && keyword.toLowerCase().includes('critical')) {
        completeStep(0);
    }
}

function cmdDecode(args) {
    if (args.length === 0) {
        printLine('Usage: decode <token>', 'error-line');
        return;
    }
    
    const token = args[0].toUpperCase();
    let decoded = '';
    
    for (let char of token) {
        if (char >= 'A' && char <= 'Z') {
            let code = char.charCodeAt(0) - 2;
            if (code < 65) code += 26;
            decoded += String.fromCharCode(code);
        } else {
            decoded += char;
        }
    }
    
    printLine(`Decoding: ${token}`, 'header-line');
    printLine(`Result: ${decoded}`, 'success-line glow');
    
    addToInventory(`Decoded: ${decoded}`);
    
    if (GAME_STATE.currentLevel === 2) {
        if (!GAME_STATE.decodedCount) GAME_STATE.decodedCount = 0;
        GAME_STATE.decodedCount++;
        
        if (GAME_STATE.decodedCount === 1) completeStep(1);
        if (GAME_STATE.decodedCount === 3) completeStep(2);
    }
}

function cmdAnalyze(args) {
    if (args.length === 0) {
        printLine('Usage: analyze <file>', 'error-line');
        return;
    }
    
    const path = args[0];
    const content = getFile(path);
    
    if (content === null) {
        printLine(`File not found: ${path}`, 'error-line');
        return;
    }
    
    printLine(`Analyzing ${path}...`, 'header-line');
    printLine('');
    printLine(`Size: ${content.length} bytes`, 'dim-line');
    printLine(`Lines: ${content.split('\n').length}`, 'dim-line');
    
    const keywords = content.match(/CODE-\d+|REC-\d+|ENCODED|CRITICAL|ERROR/g);
    if (keywords) {
        printLine(`Keywords found: ${keywords.join(', ')}`, 'success-line');
    }
}

function cmdInventory() {
    if (GAME_STATE.inventory.length === 0) {
        printLine('Inventory is empty.', 'dim-line');
        return;
    }
    
    printLine('INVENTORY:', 'header-line');
    printLine('');
    GAME_STATE.inventory.forEach(item => {
        printLine(`  > ${item}`, 'warning-line');
    });
}

function cmdObjective() {
    printLine('CURRENT MISSION:', 'header-line');
    printLine('');
    printLine(currentLevel.objective, 'success-line');
    printLine('');
    printLine('CHECKLIST:', 'header-line');
    currentLevel.checklist.forEach((item, i) => {
        const done = GAME_STATE.completedSteps.includes(i);
        printLine(`  ${done ? '[âœ“]' : '[ ]'} ${item}`, done ? 'dim-line' : 'output-line');
    });
}

function cmdHint() {
    if (GAME_STATE.hintCount >= currentLevel.hints.length) {
        printLine('No more hints available.', 'warning-line');
        return;
    }
    
    const hint = currentLevel.hints[GAME_STATE.hintCount];
    printLine(`[AGENT HINT] ${hint}`, 'agent-line');
    
    GAME_STATE.hintCount++;
    GAME_STATE.hintsUsed++;
    playSound('hint');
}

function cmdExplain() {
    const explains = [
        'Your last command helped you explore the system.',
        'That revealed important information.',
        'You\'re making progress toward the objective.',
        'Keep following the clues.'
    ];
    
    const explain = explains[Math.floor(Math.random() * explains.length)];
    printLine(`[AGENT] ${explain}`, 'agent-line');
}

function cmdSubmit(args) {
    if (args.length === 0) {
        printLine('Usage: submit <answer>', 'error-line');
        return;
    }
    
    const answer = args.join(' ').toUpperCase();
    
    if (currentLevel.id === 1) {
        if (answer === currentLevel.solution) {
            printLine('ACCESS CODE ACCEPTED!', 'success-line glow');
            completeStep(3);
            setTimeout(() => completeLevel(), 1000);
        } else {
            printLine('Invalid code. Try again.', 'error-line');
        }
    } else if (currentLevel.id === 2) {
        if (answer.includes('DEVICE_B') && answer.includes('REC-8844')) {
            printLine('RECOVERY PROTOCOL INITIATED!', 'success-line glow');
            completeStep(3);
            setTimeout(() => completeLevel(), 1000);
        } else {
            printLine('Invalid submission. Check device ID and recovery key.', 'error-line');
        }
    } else if (currentLevel.id === 3) {
        const correctWords = ['DOORMAN', 'CONTROL', 'ACCESS'];
        const hasAll = correctWords.every(word => answer.includes(word));
        
        if (hasAll) {
            printLine('PASSPHRASE ACCEPTED! VAULT UNLOCKING...', 'success-line glow');
            completeStep(3);
            setTimeout(() => completeLevel(), 1000);
        } else {
            printLine('Incorrect passphrase. Decode all tokens first.', 'error-line');
        }
    }
}

function cmdMap() {
    if (currentLevel.id !== 4) {
        printLine('Map command not available in this level.', 'error-line');
        return;
    }
    
    printLine('NETWORK TOPOLOGY:', 'header-line');
    printLine('');
    printLine('    [GATEWAY]', 'dim-line');
    printLine('       |', 'dim-line');
    printLine('    [ROUTER-3]', 'dim-line');
    printLine('      / \\', 'dim-line');
    printLine('     /   \\', 'dim-line');
    printLine('[NODE-5] [VAULT-NODE-7]', 'success-line');
    printLine('');
    
    completeStep(0);
}

function cmdTrace(args) {
    if (currentLevel.id !== 4) {
        printLine('Trace command not available.', 'error-line');
        return;
    }
    
    if (args.length === 0) {
        printLine('Usage: trace <node>', 'error-line');
        return;
    }
    
    const node = args[0].toUpperCase();
    
    if (node === 'VAULT-NODE-7') {
        printLine('Tracing VAULT-NODE-7...', 'header-line');
        printLine('Connection established.', 'success-line');
        printLine('Connection ID: CONN-9732', 'success-line glow');
        addToInventory('Connection: CONN-9732');
        completeStep(1);
    } else {
        printLine(`Node ${node} is not a vault node.`, 'warning-line');
    }
}

function cmdHandshake(args) {
    if (currentLevel.id !== 4) {
        printLine('Handshake command not available.', 'error-line');
        return;
    }
    
    if (!GAME_STATE.inventory.some(i => i.includes('CONN-9732'))) {
        printLine('No active connection. Trace a node first.', 'error-line');
        return;
    }
    
    printLine('Initiating handshake protocol...', 'header-line');
    printLine('Handshake sequence: OK', 'success-line');
    printLine('Authentication: VERIFIED', 'success-line');
    printLine('Vault is ready to unlock.', 'success-line glow');
    
    completeStep(2);
}

function cmdUnlock() {
    if (currentLevel.id !== 4) {
        printLine('Unlock command not available.', 'error-line');
        return;
    }
    
    if (!GAME_STATE.completedSteps.includes(2)) {
        printLine('Complete handshake first.', 'error-line');
        return;
    }
    
    printLine('UNLOCKING VAULT...', 'header-line glow');
    printLine('', 'output-line');
    printLine('â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'success-line');
    printLine('â–ˆ VAULT OPENED          â–ˆ', 'success-line glow');
    printLine('â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'success-line');
    printLine('', 'output-line');
    
    completeStep(3);
    setTimeout(() => completeLevel(), 1500);
}

function resolvePath(path) {
    if (path === '~' || path === '') return '~';
    if (path.startsWith('~')) return path;
    if (path.startsWith('/')) return '~' + path;
    
    if (GAME_STATE.currentPath === '~') {
        return '~/' + path;
    }
    return GAME_STATE.currentPath + '/' + path;
}

function getDirectory(path) {
    const parts = path.replace('~', '').split('/').filter(p => p);
    let current = currentLevel.filesystem['~'];
    
    for (const part of parts) {
        if (!current[part] || typeof current[part] === 'string') return null;
        current = current[part];
    }
    
    return current;
}

function getFile(path) {
    const resolved = resolvePath(path);
    const parts = resolved.replace('~', '').split('/').filter(p => p);
    let current = currentLevel.filesystem['~'];
    
    for (let i = 0; i < parts.length - 1; i++) {
        if (!current[parts[i]]) return null;
        current = current[parts[i]];
    }
    
    const fileName = parts[parts.length - 1];
    return current[fileName] || null;
}

function completeLevel() {
    stopTimer();
    
    const elapsed = Date.now() - GAME_STATE.levelStartTime;
    const mins = Math.floor(elapsed / 60000);
    const secs = Math.floor((elapsed % 60000) / 1000);
    
    let levelScore = 1000;
    levelScore += Math.max(0, 500 - GAME_STATE.commandCount * 10);
    levelScore += Math.max(0, 300 - GAME_STATE.hintsUsed * 50);
    levelScore += Math.max(0, 200 - Math.floor(elapsed / 1000));
    
    GAME_STATE.score += levelScore;
    
    let rank = 'C';
    if (levelScore >= 1500) rank = 'S';
    else if (levelScore >= 1200) rank = 'A';
    else if (levelScore >= 900) rank = 'B';
    
    document.getElementById('rankDisplay').textContent = rank;
    document.getElementById('completionTime').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
    document.getElementById('commandCount').textContent = GAME_STATE.commandCount;
    document.getElementById('hintsUsed').textContent = GAME_STATE.hintsUsed;
    document.getElementById('levelScore').textContent = levelScore;
    
    updateScore();
    
    if (GAME_STATE.currentLevel >= LEVELS.length - 1) {
        document.getElementById('finalScore').textContent = GAME_STATE.score;
        setTimeout(() => {
            document.getElementById('levelCompleteOverlay').classList.add('hidden');
            document.getElementById('gameCompleteOverlay').classList.remove('hidden');
        }, 2000);
    }
    
    document.getElementById('levelCompleteOverlay').classList.remove('hidden');
    playSound('complete');
}

function playSound(type) {
    if (!CONFIG.soundEnabled) return;
    
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    if (type === 'success') {
        oscillator.frequency.value = 800;
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.1);
    } else if (type === 'hint') {
        oscillator.frequency.value = 600;
        gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.15);
    } else if (type === 'complete') {
        oscillator.frequency.value = 1200;
        gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.3);
    }
}

function updateSoundButton() {
    document.getElementById('soundBtn').textContent = `SOUND: ${CONFIG.soundEnabled ? 'ON' : 'OFF'}`;
}

inputField.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
        const input = inputField.value;
        inputField.value = '';
        processCommand(input);
    } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        if (GAME_STATE.historyIndex > 0) {
            GAME_STATE.historyIndex--;
            inputField.value = GAME_STATE.commandHistory[GAME_STATE.historyIndex];
        }
    } else if (e.key === 'ArrowDown') {
        e.preventDefault();
        if (GAME_STATE.historyIndex < GAME_STATE.commandHistory.length - 1) {
            GAME_STATE.historyIndex++;
            inputField.value = GAME_STATE.commandHistory[GAME_STATE.historyIndex];
        } else {
            GAME_STATE.historyIndex = GAME_STATE.commandHistory.length;
            inputField.value = '';
        }
    }
});

document.getElementById('startGameBtn').addEventListener('click', () => {
    document.getElementById('titleOverlay').classList.add('hidden');
    if (!CONFIG.tutorialSeen) {
        document.getElementById('tutorialOverlay').classList.remove('hidden');
    } else {
        startLevel(0);
    }
});

document.getElementById('tutorialBtn').addEventListener('click', () => {
    document.getElementById('titleOverlay').classList.add('hidden');
    document.getElementById('tutorialOverlay').classList.remove('hidden');
});

let tutStep = 1;

document.getElementById('tutNextBtn').addEventListener('click', () => {
    document.getElementById(`tutStep${tutStep}`).classList.remove('active');
    tutStep++;
    document.getElementById(`tutStep${tutStep}`).classList.add('active');
    
    if (tutStep === 5) {
        document.getElementById('tutNextBtn').classList.add('hidden');
        document.getElementById('tutStartBtn').classList.remove('hidden');
    }
    
    if (tutStep > 1) {
        document.getElementById('tutBackBtn').classList.remove('hidden');
    }
});

document.getElementById('tutBackBtn').addEventListener('click', () => {
    document.getElementById(`tutStep${tutStep}`).classList.remove('active');
    tutStep--;
    document.getElementById(`tutStep${tutStep}`).classList.add('active');
    
    if (tutStep < 5) {
        document.getElementById('tutNextBtn').classList.remove('hidden');
        document.getElementById('tutStartBtn').classList.add('hidden');
    }
    
    if (tutStep === 1) {
        document.getElementById('tutBackBtn').classList.add('hidden');
    }
});

document.getElementById('tutStartBtn').addEventListener('click', () => {
    if (document.getElementById('skipTutorial').checked) {
        CONFIG.tutorialSeen = true;
        saveProgress();
    }
    document.getElementById('tutorialOverlay').classList.add('hidden');
    startLevel(0);
});

document.getElementById('helpBtn').addEventListener('click', () => {
    tutStep = 1;
    document.getElementById('tutStep1').classList.add('active');
    document.getElementById('tutStep2').classList.remove('active');
    document.getElementById('tutStep3').classList.remove('active');
    document.getElementById('tutStep4').classList.remove('active');
    document.getElementById('tutStep5').classList.remove('active');
    document.getElementById('tutNextBtn').classList.remove('hidden');
    document.getElementById('tutStartBtn').classList.add('hidden');
    document.getElementById('tutBackBtn').classList.add('hidden');
    document.getElementById('tutorialOverlay').classList.remove('hidden');
});

document.getElementById('soundBtn').addEventListener('click', () => {
    CONFIG.soundEnabled = !CONFIG.soundEnabled;
    updateSoundButton();
    saveProgress();
});

document.getElementById('hintBtn').addEventListener('click', () => {
    cmdHint([]);
});

document.getElementById('explainBtn').addEventListener('click', () => {
    cmdExplain([]);
});

document.getElementById('suggestBtn').addEventListener('click', () => {
    if (GAME_STATE.hintCount < currentLevel.hints.length) {
        const suggestion = currentLevel.hints[GAME_STATE.hintCount];
        const suggestionEl = document.getElementById('agentSuggestion');
        suggestionEl.textContent = `ðŸ’¡ ${suggestion}`;
        suggestionEl.classList.add('visible');
        
        setTimeout(() => {
            suggestionEl.classList.remove('visible');
        }, 8000);
    }
});

document.getElementById('whyBtn').addEventListener('click', () => {
    const why = [
        'Based on the mission objective, you need to gather information from the filesystem.',
        'The clues you need are hidden in various files. Explore systematically.',
        'Each step in the checklist guides you toward the solution.',
        'Use the commands you\'ve learned to search, read, and analyze.'
    ];
    
    printLine(`[AGENT] ${why[Math.floor(Math.random() * why.length)]}`, 'agent-line');
    printLine('');
});

document.getElementById('nextLevelBtn').addEventListener('click', () => {
    document.getElementById('levelCompleteOverlay').classList.add('hidden');
    startLevel(GAME_STATE.currentLevel + 1);
});

document.getElementById('retryLevelBtn').addEventListener('click', () => {
    document.getElementById('levelCompleteOverlay').classList.add('hidden');
    startLevel(GAME_STATE.currentLevel);
});

document.getElementById('playAgainBtn').addEventListener('click', () => {
    GAME_STATE.score = 0;
    GAME_STATE.currentLevel = 0;
    updateScore();
    document.getElementById('gameCompleteOverlay').classList.add('hidden');
    startLevel(0);
});

initGame();
</script>

</body>
</html>